#!/usr/bin/env python3

import sys
import argparse
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

def read_data():
# サンプルの DataFrame を作成
    df_meas = pd.DataFrame({
        'Ion': [22.5, 23.0, 21.8, 24.1, 15.0, 11.5, 13.0, 14.2],
        'Drain': ['BL','BL','BL','BL','SL','SL','SL','SL'],
    })
    df_sim = pd.DataFrame({
        'Ion': [23.5, 21.0, 21.3, 24.9, 14.0, 15.5, 13.2, 13.8],
        'Drain': ['BL','BL','BL','BL','SL','SL','SL','SL'],
    })
    
    return df_meas, df_sim


def plot(df_meas, df_sim, colx, drain_list):
    ndrain = len(drain_list)

    fig: plt.Figure
    ax: plt.Axes
    fig, axes = plt.subplots(ndrain, 1, figsize=(6, 2*ndrain))
    if not isinstance(axes, np.ndarray): axes = [axes]        

    colors = plt.rcParams['axes.prop_cycle'].by_key()['color']

    for idx, drain in enumerate(drain_list):
        ncond = len(df_meas[df_meas['Drain']==drain])
        x = range(1, ncond+1)
        ax = axes[idx]
        ax.tick_params(direction='in')
        ax.set_xticks(x) # 0,1,2,3,... の整数目盛り
        ax.tick_params(labelbottom=False)
        ax.set_ylabel(f"{colx}@{drain}")

        ax.plot(x, df_meas[df_meas['Drain']==drain][colx], 'o', label='Exp.', color=colors[idx])
        ax.plot(x, df_sim[df_sim['Drain']==drain][colx], 'x', label='Sim.', color=colors[idx])
        ax.legend(loc='best')

    plt.tight_layout()
    plt.show()


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('-x', '--colx', type=str, default='Ion')
    parser.add_argument('-d', '--drains', type=str, nargs='+', default=['BL'], choices=['BL','SL'])
    args = parser.parse_args()

    colx = args.colx
    drains = args.drains if isinstance(args.drains, list) else [args.drains]
    print(f"colx = {colx}")
    print(f"drain = {drains}")

    df_meas, df_sim = read_data()

    plot(df_meas, df_sim, colx, drains)

    
if __name__ == "__main__":
    main()

